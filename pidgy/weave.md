# Woven text

    import IPython, pidgy.base, traitlets, jinja2
    with pidgy.pidgyLoader(): import pidgy.compat.templating

    __all__ = 'Weave',

Nominally, since the earliest illuminated manuscripts, text is woven with type and form. In [literate programming], the weave step explicitly refers to the act of converting an input source in to other readable forms.
For example, the original [WEB] implementation models the properties of printed documents using the [TeX] document language.
`pidgy` shares the same concerns with the form of the published document; in fact, this workflow produces a [PDF] document using the [ReadTheDocs] open-source service with [DVI], Knuth's original woven target, as an intermediate product[^dvi].

    class Weave(pidgy.base.Trait):

However, prior to printed forms, `pidgy` is concerned with the ability to `Weave` hypertext and hypermedia forms generated by [literate computing] and composing documents in modern web-browsers. `pidgy` uses as a document formatting language; it is chosen because it is the default document language of `jupyter` technologies.

The source code for `pidgy` is always [Markdown], it provides both the design and computation of an input. In [pidgy]

The `Weave` class controls the display of `pidgy` outputs, and it relies on the `Weave.parent` interactive shell.

        @pidgy.implementation
        def post_run_cell(self, result):

The `Weave` step is invoked after a cell or code has been executed.

            text = pidgy.util.strip_front_matter(result.info.raw_cell)
            lines = text.splitlines() or ['']
            if not lines[0].strip(): return

`pidgy` defers from printing the output if the first line is blank.

            if self.render_template: text = self.render(text)

By default, `pidgy` will can transclude variables from a working program into the output creating rich data driven programs.

            IPython.display.display(IPython.display.Markdown(text))

## Transclusion with `jinja2` templates.

`jinja2` is a convention for notebooks in the `nbconvert` universe. `jinja2` is a popular templating engine that makes it possible to put programmatic objects into text.

        environment = traitlets.Instance('jinja2.Environment')
        @traitlets.default('environment')
        def _default_environment(self):

`Weave._default_exporter` is used to configure the start of the templating environment.

            return pidgy.compat.templating.environment()

        render_template = traitlets.Bool(True)

By default templates are always rendered, but this feature can be turned off.

        def render(self, text):
            import builtins, operator
            try:
                template = self.environment.from_string(text, globals={
                    **vars(builtins), **vars(operator),
                    **(getattr(self.parent, 'user_ns', {})).get('__annotations__', {}),
                    **getattr(self.parent, 'user_ns', {})})
                return template.render()
            except BaseException as Exception: self.parent.showtraceback((type(Exception), Exception, Exception.__traceback__))
            return text
